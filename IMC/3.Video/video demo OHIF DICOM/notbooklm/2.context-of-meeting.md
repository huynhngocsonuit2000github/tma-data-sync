Để giúp bạn nắm bắt nội dung dễ dàng hơn, tôi đã hệ thống lại bối cảnh (context) của buổi demo kỹ thuật này một cách logic và rành mạch như sau:
1. Tổng quan về Hệ thống và Mã nguồn
Hệ thống này là một nền tảng quản lý và xem hình ảnh y tế (DICOM), được xây dựng dựa trên dự án mã nguồn mở DICOM Cloud.
• Các Repository chính: Có ba kho lưu trữ mã nguồn quan trọng là useful, responsible và maestro dot com.
• Mục đích: Phục vụ cho hai đối tượng chính là Maestro và Sponsor Portal (cổng thông tin nhà tài trợ).
• Công nghệ: Sử dụng .NET (phiên bản 7) cho máy chủ web và dự án OHIF cho trình xem hình ảnh.
2. Cấu trúc Lưu trữ và Dữ liệu
Dữ liệu hình ảnh được quản lý theo phân cấp nghiêm ngặt để tối ưu hóa việc truy xuất:
• Cơ sở dữ liệu (Database): Rất đơn giản, gồm 4 bảng chính. Trong môi trường phát triển (dev/val), DB nằm cùng server với ứng dụng, nhưng ở bản Production, nó có server riêng là prod .com.
• Lưu trữ AWS S3: Hình ảnh thực tế được lưu trên đám mây AWS S3. Quy trình tìm tệp là: Study (Lần quét) → Series (Chuỗi hình) → Object Instance (Hình ảnh cụ thể).
• Tối ưu hóa: Các thẻ (tags) của tệp DICOM được lưu vào DB dưới dạng nhị phân (binary) để hệ thống trả về thông tin nhanh hơn mà không cần mở tệp gốc mỗi khi có yêu cầu.
3. Các Dịch vụ lõi (Core Services)
Hệ thống được vận hành bởi hai dịch vụ cơ bản trong cụm Hikas:
• Kaido: Chuyên trách việc truy vấn (query) thông tin nghiên cứu từ cơ sở dữ liệu.
• Watto: Chuyên trách việc xử lý và trả về hình ảnh thực tế.
• Lưu ý: Hệ thống này chủ yếu dùng để xem và lấy dữ liệu. Các tác vụ nặng như chỉnh sửa hình ảnh sẽ do một công cụ khác tên là Jet đảm nhận.
4. Cơ chế Xác thực và Phân quyền
Đây là phần quan trọng để đảm bảo bảo mật dữ liệu y tế:
• Người dùng Maestro: Được xác thực thông qua Cookie.
• Người dùng External (All zero): Được xác thực dựa trên Email thông qua API của Office.
• Quyền truy cập: Trước khi trả về hình ảnh, hệ thống luôn kiểm tra xem người dùng đó có được gán quyền xem Study (nghiên cứu) đó hay không.
5. Trình xem OHIF (The Viewer)
Hệ thống sử dụng trình xem mã nguồn mở OHIF:
• Phiên bản: Hiện tại chủ yếu dùng v2 (OHIF version 2) vì nó ổn định và đã được tùy chỉnh (loại bỏ các nút không cần thiết như nút Download). Phiên bản v3 đang được triển khai ở môi trường dev nhưng chưa hoàn thiện.
• Cấu hình (Config): Tệp default.js là quan trọng nhất vì nó chứa thông tin xác thực và endpoint. Lưu ý đặc biệt: Khi trộn mã nguồn (merge code), phải luôn bỏ qua (skip) tệp này để tránh ghi đè cấu hình của các môi trường khác nhau, nếu không trình xem sẽ không hiển thị được ảnh.
6. Quản lý lỗi và Bảo trì
• Lỗi thường gặp: Lỗi "Error loading image" thường do lấy được tệp nhưng định dạng không tương thích hoặc thiếu thông tin thẻ DICOM (như tuổi bệnh nhân).
• Khắc phục sự cố: Sử dụng Postman để kiểm tra API, kiểm tra log trên máy chủ web hoặc dùng phím F12 (Inspect) để xem lỗi trực tiếp trên trình duyệt.
• Yêu cầu kỹ thuật: Để build (xây dựng) dự án, kỹ sư cần cài đặt Yarn 1.17 và quá trình này tốn khá nhiều tài nguyên hệ thống.